FROM httpd:2.4-alpine

ENV CKAN_PORT=5000
ENV PYCSW_PORT=8000
ENV PYCSW_COMPOSE_SERVICE=pycsw
ENV CKAN_COMPOSE_SERVICE=ckan
ENV CKAN_DEV_COMPOSE_SERVICE=ckan-dev
ENV APACHE_PORT=80
ENV APACHE_LOG_DIR=/var/log/apache
ENV APACHE_ROOT=/usr/local/apache2
ENV APACHE_DOCUMENT_ROOT=${APACHE_ROOT}/htdocs
ENV PROXY_SERVER_NAME=localhost

ENV PROXY_CKAN_LOCATION=/catalog
ENV PROXY_PYCSW_LOCATION=/csw
ENV PROXY_PYCSW_PROXY_PASS=http://${PYCSW_COMPOSE_SERVICE}:${PYCSW_PORT}
ENV PROXY_CKAN_PROXY_PASS=http://${CKAN_COMPOSE_SERVICE}:${CKAN_PORT}

RUN mkdir -p ${APACHE_LOG_DIR}

COPY setup/httpd.conf ${APACHE_ROOT}/conf/httpd.conf
COPY setup/index.html ${APACHE_DOCUMENT_ROOT}/index.html

EXPOSE ${APACHE_PORT}